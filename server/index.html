<html>
<head>
    <link rel="stylesheet" type="text/css" href="css/c3.min.css">
    <link rel="stylesheet" type="text/css" href="css/simple-slider.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/simple-slider-volume.css">

</head>
<body data-feedly-mini="yes">
<div class="col-lg-12 center-block" style="width: 300px">

    <div class="center-block">
        <input class="nHost center-block" type="text" data-slider="true" data-slider-range="0,128" data-slider-step="1" data-slider-highlight="true" data-slider-theme="volume"></div>
    Number host up <span class="nhost value text-center">0</span>

    <div class="center-block">
        <input class="nSlow center-block" type="text" data-slider="true" data-slider-range="0,128" data-slider-step="1" data-slider-highlight="true" data-slider-theme="volume"></div>
    Number slow host <span class="nSlow value text-center">0</span>

    <input class="rpc center-block" type="button" value="Submit" onclick="doFunction();">
</div>
<div class="col-lg-12">

    <h3>CDN</h3>
    <div id="chart2" ></div>
    <h3>VCDN</h3>
<div id="chart" ></div>

</div>


<script src="js/d3.min.js" charset="utf-8"></script>
<script src="js/c3.min.js"></script>
<script src="js/jquery.js"></script>
<script src="js/jquery.xmlrpc.min.js"></script>
<script src="js/simple-slider.min.js"></script>

<script>
    var url= window.location.origin;
    var urlrpc=url.replace('9998','8000')

    var nbhost=0;
    var nbslow=0


//    $("input.nhost").simpleSlider();
    function doFunction(){
        nbslowS=nbslow;
        nbhostS=nbhost;
        if (nbslow>nbhost){
            nbslowS=nbhost;
        }
        $.xmlrpc({
            url: urlrpc,
            methodName: 'load',
            params: [nbhostS, nbslowS],
            success: function(response, status, jqXHR) {
                console.log(response)

            },
            error: function(jqXHR, status, error) {
                console.log(error)
            }
        });
    }
    $("input.nhost").bind("slider:changed", function (event, data) {
        nbhost=data.value
        console.log(data.value);
        $("span.nhost").text(data.value);
        // The value as a ratio of the slider (between 0 and 1)
//        console.log(data.ratio);
    });

//    $("input.nSlow").simpleSlider();

    $("input.nSlow").bind("slider:changed", function (event, data) {
        nbslow=data.value
        $("span.nSlow").text(data.value);
    });

</script>

<script>

    var url = window.location.origin;
    var data = {};
    var timeValue=[];
    var outValue=[];
    var inValue=[];
    var dateStr=["date"]
    var outStr=["out"];
    var inStr=["in"]
    var chart = c3.generate({
        bindto: '#chart',
        data: {
            x: 'date',
            columns: [
                dateStr.concat(timeValue),
                outStr.concat(outValue),
                inStr.concat(inValue)
            ],
        },
        axis: {
            x: {
                type: 'timeseries',
                tick: {
                    format : "%H:%M:%S"
                }
            }
        }
    });

    function getData() {
        $.ajax({
            url: url + "/fast.json",

            success: function (result) {

//                console.log(result);


                result.forEach(function(entry) {
                    if (!(entry.time in data)) {
                        data[entry.time]=entry;
//                        timedate = new Date(entry.time*1000)
                        timeValue.push(new Date(entry.time*1000));
                        outValue.push(entry.out/1024/1024);
                        inValue.push(entry.in/1024/1024);
//                        chart.flow({
//                            columns: [
//                                [dateStr[0],timedate],
//                                 [ outStr[0],entry.out],
//                                 [ inStr[0],entry.in]
//                            ],
//                            length:10
//
//                        });

                    }
                });

                chart.load({
                    columns: [
                        dateStr.concat(timeValue),
                        outStr.concat(outValue),
                        inStr.concat(inValue)
                    ]
                });


            }
        });
    }

    var dataF = {};
    var timeValueF=[];
    var outValueF=[];
    var inValueF=[];

    var chart2 = c3.generate({
        bindto: '#chart2',
        data: {
            x: 'date',
            columns: [
                dateStr.concat(timeValueF),
                outStr.concat(outValueF),
                inStr.concat(inValueF)
            ],
        },
        axis: {
            x: {
                type: 'timeseries',
                tick: {
                    format : "%H:%M:%S"
                }
            }
        }
    });

    function getDataSlow() {
        $.ajax({
            url: url + "/slow.json",
            success: function (result) {

//                console.log(result);


                result.forEach(function(entry) {
                    if (!(entry.time in data)) {
                        dataF[entry.time]=entry;
//                        timedate = new Date(entry.time*1000)
                        timeValueF.push(new Date(entry.time*1000));
                        outValueF.push(entry.out*8/1024/1024);
                        inValueF.push(entry.in*8/1024/1024);
//                        chart.flow({
//                            columns: [
//                                [dateStr[0],timedate],
//                                 [ outStr[0],entry.out],
//                                 [ inStr[0],entry.in]
//                            ],
//                            length:10
//
//                        });

                    }
                });

                chart2.load({
                    columns: [
                        dateStr.concat(timeValueF),
                        outStr.concat(outValueF),
                        inStr.concat(inValueF)
                    ]
                });


            }
        });
    };






    timer = setInterval(function () {
            getDataSlow()
    	}, 10000);
    timer = setInterval(function () {
        getData()
    }, 10000);





</script>


<div id="feedly-mini" title="feedly Mini tookit"></div>
</body>
</html>
